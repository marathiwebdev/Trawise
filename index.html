<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trawise — Trade Smartly and Grow Wisely</title>

  <!-- Minimal reset + professional typography -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Merriweather:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f8fb; --nav:#11324d; --card:#ffffff; --muted:#596a7a; --accent:#0b78d1; --ok:#0f9d58; --warn:#f39c12;
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#102128;background:var(--bg)}
    a{color:var(--accent);text-decoration:none}
    /* Top government-like banner */
    .topbar{background:#08263a;color:#fff;padding:8px 0;font-size:13px;border-bottom:4px solid #0e3b55}
    .topbar .container{max-width:var(--maxw);margin:0 auto;display:flex;gap:12px;align-items:center;padding:6px 14px}
    .dotgov{display:inline-flex;align-items:center;gap:8px;font-weight:600}
    .dotgov img{height:22px}
    .container{max-width:var(--maxw);margin:20px auto;padding:0 14px}
    header.sitehead{display:flex;align-items:flex-end;gap:18px;padding:8px 0 20px}
    header .brand{font-family:Merriweather,serif;font-size:28px;color:#0b2340}
    header .slogan{color:var(--muted);font-size:14px;margin-bottom:4px}

    /* layout */
    .layout{display:grid;grid-template-columns:260px 1fr;gap:20px}
    .sidebar{background:var(--card);border-radius:8px;padding:14px;border:1px solid #e6edf3;box-shadow:0 1px 0 rgba(16,33,40,0.03)}
    .sidebar h3{margin:0 0 12px 0;color:#0b2340}
    .navlink{display:block;padding:8px 10px;border-radius:6px;color:#0b2340;margin-bottom:6px;font-weight:600;border:1px solid transparent}
    .navlink:hover{background:#f1f6fb;border-color:#e2eefb}
    .main{min-height:60vh}
    .card{background:var(--card);padding:16px;border-radius:8px;border:1px solid #e6edf3;margin-bottom:14px}
    .muted{color:var(--muted)}
    .grid-2{display:grid;grid-template-columns:1fr 280px;gap:16px}
    .plans-row{display:flex;gap:10px;flex-wrap:wrap}

    /* Plan button */
    .plan-card{flex:1;min-width:200px;background:#f8fbff;border:1px solid #e7f0fb;padding:12px;border-radius:8px}
    .plan-title{font-weight:700;color:#072033}
    .plan-meta{font-size:13px;color:var(--muted);margin:6px 0}
    .btn{display:inline-block;background:var(--accent);color:white;padding:8px 12px;border-radius:6px;border:0;cursor:pointer;font-weight:700}
    .btn.secondary{background:#2f4858}
    .btn.ghost{background:transparent;border:1px solid #d6e7fb;color:#0b2340}

    /* table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #f1f4f6;text-align:left}
    th{font-weight:700;color:#0b2340}

    /* responsive */
    @media (max-width:900px){
      .layout{grid-template-columns:1fr; padding:0 10px}
      .grid-2{grid-template-columns:1fr}
      .topbar .container{padding:6px 10px}
    }

    /* small helpers */
    .right{float:right}
    .kbd{background:#eef6ff;padding:4px 8px;border-radius:6px;border:1px solid #d9ecff;font-family:ui-monospace,monospace}
    .status-pill{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700;font-size:13px}
    .status-active{background:#e6f7ef;color:var(--ok);border:1px solid #cdebd9}
    .status-pending{background:#fff5e6;color:var(--warn);border:1px solid #f3e0c0}
  </style>
</head>
<body>
  <!-- top bar (gov-style) -->
  <div class="topbar" role="banner">
    <div class="container" aria-hidden="false">
      <div class="dotgov">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/16/US_flag_small.png" alt="flag" />
        <span>Official demo — Trawise</span>
      </div>
      <div style="flex:1"></div>
      <div class="muted">Secure connection • HTTPS</div>
    </div>
  </div>

  <div class="container" role="main">
    <!-- header -->
    <header class="sitehead" role="heading" aria-level="1">
      <div>
        <div class="brand">Trawise</div>
        <div class="slogan">Trade Smartly and Grow Wisely</div>
      </div>
      <div style="flex:1"></div>
      <div id="user-area" class="muted" style="text-align:right">
        <div id="navAuth" class="">
          <span id="navEmailText">Not signed in</span>
          <div style="margin-top:6px">
            <button class="btn ghost" id="openAuthBtn">Sign in</button>
          </div>
        </div>
      </div>
    </header>

    <div class="layout" aria-live="polite">
      <!-- left sidebar / navigation -->
      <aside class="sidebar" aria-label="Main navigation">
        <h3>Navigation</h3>
        <a class="navlink" href="#" onclick="scrollToSection('overview')">Overview</a>
        <a class="navlink" href="#" onclick="scrollToSection('plans')">Invest Plans</a>
        <a class="navlink" href="#" onclick="scrollToSection('myinvest')">My Investments</a>
        <a class="navlink" href="#" onclick="openBank()">Bank / UPI</a>

        <hr style="margin:12px 0;border:none;border-top:1px solid #f1f4f6">
        <div class="muted">Admin</div>
        <a class="navlink" href="#" onclick="openAdmin()" id="adminLink" style="display:none">Admin Panel</a>
      </aside>

      <!-- main content -->
      <main class="main">
        <!-- breadcrumb / intro -->
        <div class="card" id="overview">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="flex:1">
              <h2 style="margin:0">How Trawise investments work</h2>
              <p class="muted" style="margin:6px 0 0">Simple fixed-month plans — transparent returns. This interface is modeled for clarity and trust (inspired by Investor.gov layout).  [oai_citation:1‡Investor](https://www.investor.gov/introduction-investing/investing-basics/how-stock-markets-work)</p>
            </div>
            <div style="text-align:right">
              <div class="muted">Member since</div>
              <div id="memberSince" class="kbd">—</div>
            </div>
          </div>
        </div>

        <!-- content grid: left wide, right narrow -->
        <div class="grid-2">
          <div>
            <!-- Plans -->
            <section class="card" id="plans">
              <h3>Featured Plans</h3>
              <div class="plans-row" id="plansRow">
                <!-- injected plan cards -->
              </div>
              <p class="muted" style="margin-top:10px">All plans provide <strong>5% monthly</strong> as shown in the plan details. Choose a plan and proceed to payment.</p>
            </section>

            <!-- user's investments -->
            <section class="card" id="myinvest">
              <h3>My Investments</h3>
              <table aria-describedby="investmentSummary">
                <thead><tr><th>Plan</th><th>Principal</th><th>Start</th><th>Expiry</th><th>Status</th></tr></thead>
                <tbody id="investTable">
                  <tr><td colspan="5" class="muted">No investments found.</td></tr>
                </tbody>
              </table>
            </section>
          </div>

          <!-- right column: quick summary + admin actions -->
          <aside>
            <div class="card">
              <h4>Quick Summary</h4>
              <div style="margin-top:8px">
                <div class="muted">Balance</div>
                <div style="font-size:20px;font-weight:700">₹ <span id="balance">0</span></div>
              </div>
              <div style="margin-top:12px">
                <div class="muted">Active Plan</div>
                <div id="activePlan">—</div>
              </div>
              <div style="margin-top:12px">
                <button class="btn" onclick="scrollToSection('plans')">Invest Now</button>
              </div>
            </div>

            <div class="card" id="wallets">
              <h4>Pay Options</h4>
              <div class="muted">UPI (via Razorpay)</div>
              <div style="margin-top:8px">
                <button class="btn secondary" onclick="openPaymentModal('razor')">Pay with UPI / Card</button>
              </div>
              <hr style="margin:12px 0;border:none;border-top:1px solid #f1f4f6">
              <div class="muted">Crypto (USDT — TRC20)</div>
              <div style="margin-top:8px">
                <button class="btn ghost" onclick="openPaymentModal('usdt')">Pay with USDT (TRC20)</button>
              </div>
            </div>

            <div class="card muted">
              <strong>Security note</strong>
              <p class="muted" style="margin:8px 0 0;font-size:13px">Never share secret keys in the frontend. Verify payments server-side.</p>
            </div>
          </aside>
        </div>

        <!-- Admin panel area (hidden until admin) -->
        <section class="card hidden" id="adminPanel">
          <h3>Admin Panel</h3>
          <div id="adminContent">Loading…</div>
        </section>
      </main>
    </div>
  </div>

  <!-- === Modals & hidden auth card === -->
  <div id="authModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);justify-content:center;align-items:center">
    <div style="background:white;padding:18px;border-radius:8px;width:420px;max-width:96%;box-shadow:0 8px 30px rgba(2,11,23,0.2)">
      <h3>Sign in / Sign up</h3>
      <div style="margin:8px 0">
        <label class="muted">Name (signup)</label>
        <input id="name" style="width:100%;padding:8px;margin-top:6px;border:1px solid #e6eef6;border-radius:6px" placeholder="Full name (optional)">
      </div>
      <div style="margin:8px 0">
        <label class="muted">Email</label>
        <input id="email" style="width:100%;padding:8px;margin-top:6px;border:1px solid #e6eef6;border-radius:6px" placeholder="you@example.com">
      </div>
      <div style="margin:8px 0">
        <label class="muted">Password</label>
        <input id="password" type="password" style="width:100%;padding:8px;margin-top:6px;border:1px solid #e6eef6;border-radius:6px" placeholder="password">
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="btn ghost" onclick="closeAuth()">Close</button>
        <button class="btn secondary" id="btnLogin">Login</button>
        <button class="btn" id="btnSignup">Sign up</button>
      </div>
      <div id="authMsg" class="muted" style="margin-top:10px"></div>
    </div>
  </div>

  <div id="paymentModal" style="display:none;position:fixed;inset:0;background:rgba(2,12,25,0.45);justify-content:center;align-items:center">
    <div style="background:white;padding:18px;border-radius:8px;width:480px;max-width:96%;box-shadow:0 8px 30px rgba(2,11,23,0.2)">
      <h3 id="pmTitle">Pay for plan</h3>
      <div id="pmContent">
        <!-- dynamic content -->
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
        <button class="btn ghost" onclick="closePayment()">Close</button>
      </div>
    </div>
  </div>

  <!-- Firebase + Razorpay SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs, query, orderBy, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // ====== EDIT THESE ======
    const ADMIN_UID = "PUT_YOUR_ADMIN_UID";         // set to your UID to show admin panel
    const RAZORPAY_KEY = "rzp_test_yourkey";        // your razorpay key id
    const USDT_TRON_ADDRESS = "TRC20_WALLET_ADDRESS_HERE";
    // Firebase config (you provided earlier)
    const firebaseConfig = {
      apiKey: "AIzaSyDzxxUj1G9oMVsZgKUKmpIwKz1HCx0y-rE",
      authDomain: "trawise-app.firebaseapp.com",
      databaseURL: "https://trawise-app-default-rtdb.firebaseio.com",
      projectId: "trawise-app",
      storageBucket: "trawise-app.firebasestorage.app",
      messagingSenderId: "1075632762742",
      appId: "1:1075632762742:web:7663e8e1b639c725641457",
      measurementId: "G-V32FC1LX9F"
    };
    // ========================

    // init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // in-memory plan definitions (same as UI)
    const PLANS = [
      { id:"plan_5000", title:"₹5,000 Plan", amount:5000, durationMonths:1, monthlyPercent:5 },
      { id:"plan_10000", title:"₹10,000 Plan", amount:10000, durationMonths:3, monthlyPercent:5 },
      { id:"plan_20000", title:"₹20,000 Plan", amount:20000, durationMonths:12, monthlyPercent:5 }
    ];

    // helpers to show/hide modals
    const authModal = document.getElementById('authModal');
    const paymentModal = document.getElementById('paymentModal');
    const pmContent = document.getElementById('pmContent');
    const pmTitle = document.getElementById('pmTitle');

    // render plans
    function renderPlans(){
      const row = document.getElementById('plansRow');
      row.innerHTML = '';
      PLANS.forEach(p=>{
        const el = document.createElement('div');
        el.className = 'plan-card';
        el.innerHTML = `<div class="plan-title">${p.title}</div>
          <div class="plan-meta">${p.durationMonths} month(s) • ${p.monthlyPercent}% monthly</div>
          <div style="margin-top:8px"><button class="btn" onclick="openPaymentModal('choose', '${p.id}')">Choose & Pay</button></div>`;
        row.appendChild(el);
      });
    }
    renderPlans();

    // auth UI open/close
    document.getElementById('openAuthBtn').onclick = () => { authModal.style.display = 'flex'; };
    window.closeAuth = () => { authModal.style.display = 'none'; document.getElementById('authMsg').textContent=''; };

    // Signup & Login handlers
    document.getElementById('btnSignup').onclick = async () => {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const pass = document.getElementById('password').value;
      const msg = document.getElementById('authMsg');
      msg.textContent = 'Creating account…';
      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        // create user doc
        await setDoc(doc(db, 'users', cred.user.uid), {
          profile: { name: name || '', email, createdAt: new Date().toISOString() }
        });
        msg.textContent = 'Account created. Logged in.';
      } catch (e) {
        msg.textContent = 'Error: ' + e.message;
      }
    };

    document.getElementById('btnLogin').onclick = async () => {
      const email = document.getElementById('email').value.trim();
      const pass = document.getElementById('password').value;
      const msg = document.getElementById('authMsg');
      msg.textContent = 'Signing in…';
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        msg.textContent = 'Signed in';
        setTimeout(()=>closeAuth(),800);
      } catch (e) {
        msg.textContent = 'Error: ' + e.message;
      }
    };

    // track auth & load user data
    onAuthStateChanged(auth, async (user) => {
      const navEmailText = document.getElementById('navEmailText');
      if (user) {
        navEmailText.textContent = user.email;
        document.getElementById('openAuthBtn').style.display = 'none';
        // load profile & investments
        await loadUserData(user.uid);
        // admin gate
        if (user.uid === ADMIN_UID) {
          document.getElementById('adminLink').style.display = 'block';
          document.getElementById('adminPanel').classList.remove('hidden');
          loadAdminList();
        } else {
          document.getElementById('adminLink').style.display = 'none';
        }
      } else {
        navEmailText.textContent = 'Not signed in';
        document.getElementById('openAuthBtn').style.display = '';
        // redirect / show blank
      }
    });

    async function loadUserData(uid){
      const docRef = doc(db, 'users', uid);
      const snap = await getDoc(docRef);
      if (!snap.exists()) return;
      const data = snap.data();
      const profile = (data.profile||{});
      document.getElementById('memberSince').textContent = (profile.createdAt||'—').slice(0,10);
      const investmentsSnap = await getDocs(query(collection(db, 'users', uid, 'investments'), orderBy('startDate','desc')));
      // populate investments table
      const tbody = document.getElementById('investTable');
      tbody.innerHTML = '';
      if (investmentsSnap.empty) {
        tbody.innerHTML = '<tr><td colspan="5" class="muted">No investments found.</td></tr>';
        document.getElementById('balance').textContent = (data.balance||0);
        document.getElementById('activePlan').textContent = (data.plan||'—');
        return;
      }
      let totalBalance = data.balance || 0;
      investmentsSnap.forEach(docu=>{
        const inv = docu.data();
        const plan = PLANS.find(x=>x.id===inv.planId) || {};
        const start = (inv.startDate||'').slice(0,10);
        const expiry = (inv.expiryDate||'').slice(0,10);
        const statusClass = inv.status === 'active' ? 'status-active' : (inv.status && inv.status.toLowerCase().includes('pending') ? 'status-pending' : '');
        tbody.insertAdjacentHTML('beforeend', `<tr>
          <td>${plan.title||inv.planId}</td>
          <td>₹${(inv.principal||0).toLocaleString()}</td>
          <td>${start}</td>
          <td>${expiry}</td>
          <td><span class="status-pill ${statusClass}">${inv.status||'pending'}</span></td>
        </tr>`);
      });
      document.getElementById('balance').textContent = totalBalance;
      document.getElementById('activePlan').textContent = (data.plan||'—');
    }

    // create investment (firestore) helper
    async function createInvestmentForUser(uid, planId, principal, paymentMethod, paymentRef){
      const now = new Date();
      // approximate expiry by adding months * 30 days
      const plan = PLANS.find(p=>p.id===planId);
      const expiry = new Date(now.getTime() + (plan.durationMonths * 30 * 24 * 3600 * 1000));
      const invDocRef = doc(collection(db, 'users', uid, 'investments'));
      const invData = {
        planId,
        principal,
        monthlyPercent: plan.monthlyPercent,
        durationMonths: plan.durationMonths,
        startDate: now.toISOString(),
        expiryDate: expiry.toISOString(),
        status: paymentMethod === 'razor' ? 'active' : 'pending (' + paymentMethod + ')',
        paymentRef: paymentRef || null
      };
      await setDoc(invDocRef, invData);
      // update user top-level doc summary (balance & last plan)
      const userRef = doc(db, 'users', uid);
      await updateDoc(userRef, { plan: plan.title, balance: principal, status: invData.status });
      await loadUserData(uid);
    }

    // Payment modal flows
    window.openPaymentModal = function(mode, planId){
      // mode: 'razor', 'usdt', or 'choose'
      const pmContentEl = pmContent;
      pmContentEl.innerHTML = '';
      if(mode === 'razor'){
        pmTitle.textContent = 'Pay with Razorpay (UPI / Card)';
        pmContentEl.innerHTML = `<p class="muted">You will be redirected to Razorpay checkout. Amount: <strong id="pmAmount">—</strong></p>
          <div style="display:flex;gap:8px">
            <button class="btn" id="rzpGo">Proceed to Pay</button>
            <button class="btn ghost" onclick="closePayment()">Cancel</button>
          </div>`;
        document.getElementById('rzpGo').onclick = async ()=> {
          // for demo: create a local "order" without server (test key only) and mark active on handler
          const amount = window._PENDING_PLAN_AMOUNT;
          const planIdLocal = window._PENDING_PLAN_ID;
          const options = {
            key: RAZORPAY_KEY,
            amount: amount * 100,
            currency: "INR",
            name: "Trawise",
            description: "Investment " + planIdLocal,
            handler: async function (resp) {
              alert('Payment success: ' + resp.razorpay_payment_id);
              const user = auth.currentUser;
              await createInvestmentForUser(user.uid, planIdLocal, amount, 'razor', resp.razorpay_payment_id);
              closePayment();
            }
          };
          const rzp = new Razorpay(options);
          rzp.open();
        };
      } else if(mode === 'usdt'){
        pmTitle.textContent = 'Pay with USDT (TRC20)';
        pmContentEl.innerHTML = `<p class="muted">Send USDT (TRC20) to the address below, then paste TxID to verify.</p>
          <pre style="background:#f1f6fb;padding:10px;border-radius:6px">${USDT_TRON_ADDRESS}</pre>
          <label class="muted">Amount (₹)</label>
          <input id="usdtAmt" style="width:100%;padding:8px;margin-top:6px;border:1px solid #e6eef6;border-radius:6px" placeholder="Enter INR equivalent">
          <label class="muted" style="margin-top:8px">Transaction ID</label>
          <input id="usdtTx" style="width:100%;padding:8px;margin-top:6px;border:1px solid #e6eef6;border-radius:6px" placeholder="Paste TRC20 TxID">
          <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
            <button class="btn" id="usdtConfirm">Submit for verification</button>
            <button class="btn ghost" onclick="closePayment()">Cancel</button>
          </div>`;
        document.getElementById('usdtConfirm').onclick = async ()=>{
          const amt = Number(document.getElementById('usdtAmt').value || 0);
          const tx = document.getElementById('usdtTx').value.trim();
          if(!amt || !tx) { alert('Enter amount and TxID'); return; }
          const user = auth.currentUser;
          await createInvestmentForUser(user.uid, window._PENDING_PLAN_ID, amt, 'usdt', tx);
          alert('Submitted — pending admin verification.');
          closePayment();
        };
      } else { // choose from a plan
        const plan = PLANS.find(p=>p.id===planId);
        window._PENDING_PLAN_ID = planId;
        window._PENDING_PLAN_AMOUNT = plan.amount;
        pmTitle.textContent = 'Confirm plan: ' + plan.title;
        pmContentEl.innerHTML = `<p class="muted">Amount: <strong>₹${plan.amount}</strong></p>
          <div style="display:flex;gap:8px">
            <button class="btn" onclick="openPaymentModal('razor')">Pay with Razorpay</button>
            <button class="btn ghost" onclick="openPaymentModal('usdt')">Pay with USDT</button>
            <button class="btn secondary" onclick="closePayment()">Cancel</button>
          </div>`;
      }
      paymentModal.style.display = 'flex';
    };

    function closePayment(){ paymentModal.style.display = 'none'; pmContent.innerHTML=''; pmTitle.textContent=''; }

    // quick open bank (scroll)
    window.openBank = ()=>{ scrollToSection('wallets'); };

    // show/hide admin
    window.openAdmin = ()=>{ document.getElementById('adminPanel').classList.toggle('hidden'); scrollToSection('adminPanel'); };

    // admin list (simple)
    async function loadAdminList(){
      const usersSnap = await getDocs(collection(db, 'users'));
      const out = [];
      for(const u of usersSnap.docs){
        const data = u.data();
        // count investments
        const invSnap = await getDocs(collection(db, 'users', u.id, 'investments'));
        out.push(`<div style="margin-bottom:8px;padding:8px;border:1px solid #f1f4f6;border-radius:6px">
          <div><strong>${data.profile?.name||'—'}</strong> <span class="muted">(${data.profile?.email||'—'})</span></div>
          <div class="muted">Investments: ${invSnap.size} • Balance: ₹${data.balance||0}</div>
        </div>`);
      }
      document.getElementById('adminContent').innerHTML = out.join('');
    }

    // small util: scroll to sections
    window.scrollToSection = (id)=>{ const el = document.getElementById(id); if(el) el.scrollIntoView({behavior:'smooth',block:'start'}); };

    // logout
    window.logout = async ()=>{ await signOut(auth); window.location.reload(); };

    // load admin link state on start
    // (auth listener will reveal admin link if you set ADMIN_UID)
  </script>

  <!-- Razorpay SDK (client checkout) -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</body>
</html>
