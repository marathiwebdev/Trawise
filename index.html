<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trawise - Dashboard</title>
  <style>
    body {
      margin: 0; font-family: Arial, sans-serif; background: #f4f7fb;
    }
    header {
      background: #2d3e50; color: white; padding: 15px; text-align: center;
      font-size: 22px; font-weight: bold;
    }
    .container {
      display: flex; min-height: 100vh;
    }
    .sidebar {
      width: 220px; background: #34495e; color: white; padding: 20px;
    }
    .sidebar h2 { margin-top: 0; }
    .sidebar button {
      display: block; width: 100%; padding: 10px; margin: 10px 0;
      background: #2ecc71; color: white; border: none; cursor: pointer;
    }
    .sidebar button.logout {
      background: #e74c3c;
    }
    .main {
      flex: 1; padding: 30px;
    }
    .card {
      background: white; padding: 20px; margin: 10px 0;
      border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .plans button {
      background: #3498db; border: none; padding: 10px 20px;
      margin: 10px; color: white; border-radius: 5px; cursor: pointer;
    }
    /* Payment Modal */
    #paymentModal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 8px; width: 400px;
    }
    .modal-content h2 { margin-top: 0; }
    .modal-content button {
      width: 100%; padding: 12px; margin-top: 10px; border: none;
      border-radius: 5px; cursor: pointer;
    }
    .razor-btn { background: #2ecc71; color: white; }
    .usdt-btn { background: #f39c12; color: white; }
    .close-btn { background: #e74c3c; color: white; }
  </style>
</head>
<body>
  <header>üíπ Trawise Dashboard</header>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Menu</h2>
      <button onclick="showSection('dashboard')">üè† Dashboard</button>
      <button onclick="showSection('plans')">üìà Invest Plans</button>
      <button class="logout" onclick="logout()">üö™ Logout</button>
    </div>

    <!-- Main Content -->
    <div class="main">
      <!-- Dashboard Section -->
      <div id="dashboard" class="section">
        <h2>Welcome to Trawise</h2>
        <div class="card">
          <h3>Current Plan: <span id="plan">None</span></h3>
          <h3>Balance: ‚Çπ<span id="balance">0</span></h3>
          <h3>Status: <span id="status">Not Invested</span></h3>
        </div>
      </div>

      <!-- Plans Section -->
      <div id="plans" class="section" style="display:none;">
        <h2>Choose Your Plan</h2>
        <div class="plans">
          <button onclick="openPayment(5000)">Invest ‚Çπ5000</button>
          <button onclick="openPayment(10000)">Invest ‚Çπ10000</button>
          <button onclick="openPayment(20000)">Invest ‚Çπ20000</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div id="paymentModal">
    <div class="modal-content">
      <h2>Select Payment Method</h2>
      <button class="razor-btn" onclick="payWithRazorpay()">üí≥ Pay with UPI / Card</button>
      <h3>Or Pay with USDT (TRC20)</h3>
      <p>Send USDT to:</p>
      <code id="usdtAddress">TRc1234YourTRC20WalletAddress</code>
      <p>Enter Transaction ID:</p>
      <input type="text" id="usdtTx" placeholder="TxID" style="width:100%; padding:8px;">
      <button class="usdt-btn" onclick="confirmUSDT()">Confirm USDT Payment</button>
      <button class="close-btn" onclick="closePayment()">Close</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, update, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDzxxUj1G9oMVsZgKUKmpIwKz1HCx0y-rE",
      authDomain: "trawise-app.firebaseapp.com",
      databaseURL: "https://trawise-app-default-rtdb.firebaseio.com",
      projectId: "trawise-app",
      storageBucket: "trawise-app.firebasestorage.app",
      messagingSenderId: "1075632762742",
      appId: "1:1075632762742:web:7663e8e1b639c725641457",
      measurementId: "G-V32FC1LX9F"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let selectedAmount = 0;

    // Sidebar Navigation
    window.showSection = function(section) {
      document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
      document.getElementById(section).style.display = 'block';
    }

    // Payment Modal
    window.openPayment = function(amount) {
      selectedAmount = amount;
      document.getElementById("paymentModal").style.display = "flex";
    }
    window.closePayment = function() {
      document.getElementById("paymentModal").style.display = "none";
    }

    // Razorpay Payment
    window.payWithRazorpay = function() {
      var options = {
        "key": "rzp_test_yourkey", // Replace with your Razorpay key
        "amount": selectedAmount * 100,
        "currency": "INR",
        "name": "Trawise",
        "description": "Investment Plan",
        "handler": function (response){
          alert("Payment Successful ‚úÖ: " + response.razorpay_payment_id);
          saveInvestment("‚Çπ" + selectedAmount, selectedAmount, "Paid");
          closePayment();
        }
      };
      var rzp1 = new Razorpay(options);
      rzp1.open();
    }

    // USDT Payment
    window.confirmUSDT = function() {
      const txid = document.getElementById("usdtTx").value;
      if(txid.trim() === "") { alert("Enter TxID first"); return; }
      alert("USDT Payment Submitted ‚úÖ Pending Verification");
      saveInvestment("‚Çπ" + selectedAmount, selectedAmount, "Pending (USDT)");
      closePayment();
    }

    // Save to Firebase
    function saveInvestment(plan, amount, status) {
      const user = auth.currentUser;
      if (!user) return;
      update(ref(db, "users/" + user.uid), {
        plan: plan,
        balance: amount,
        status: status
      }).then(() => {
        document.getElementById("plan").innerText = plan;
        document.getElementById("balance").innerText = amount;
        document.getElementById("status").innerText = status;
      });
    }

    // Show user data on login
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const userRef = ref(db);
        get(child(userRef, "users/" + user.uid)).then((snapshot) => {
          if(snapshot.exists()) {
            const data = snapshot.val();
            document.getElementById("plan").innerText = data.plan || "None";
            document.getElementById("balance").innerText = data.balance || "0";
            document.getElementById("status").innerText = data.status || "Not Invested";
          }
        });
      } else {
        window.location.href = "login.html"; // redirect if not logged in
      }
    });

    // Logout
    window.logout = function() {
      signOut(auth).then(() => { window.location.href = "login.html"; });
    }
  </script>

  <!-- Razorpay SDK -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</body>
</html>
